<!DOCTYPE html>
<html lang="en">

<head>
  <title>Database Cost Comparator</title>
  <link href="https://fonts.googleapis.com/css2?family=Balsamiq+Sans&family=Barlow+Condensed:wght@100&family=Chivo+Mono&family=Luckiest+Guy&family=Oswald:wght@200&family=Permanent+Marker&family=Poppins:wght@400;600&family=Sevillana&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins';
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      box-sizing: border-box;
    }

    h1,
    h2 {
      color: #333;
      text-align: center;
      margin: 0;
      padding: 1px 0;
    }

    table {
      width: 100%;
      max-width: 1200px;
      margin-top: 20px;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .cell {
      padding: 2px;
      vertical-align: middle;
      border: 1px solid #ccc;
      /* Add a border around each cell */
    }

    .bar-group {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      width: 100%;
    }

    .bar-container {
      /* changed this from "align-items: center" to "align-items: flex-start" */
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      justify-content: space-between;
      width: 100%;
      margin-top: 20px;
    }

    .bar-label {
      width: 100%;
      text-align: center;
      color: #555;
      font-size: 18px;
      font-weight: bold;
    }

    .bar-value {
      font-weight: bold;
      color: #333;
      font-size: 15px;
    }

    .bar {
      width: 30px;
      height: 400px;
      background-color: #ddd;
      margin-bottom: 5px;
      transform: rotate(180deg);
    }

    .filled-bar {
      height: 0;
      background-color: #3498db;
      transition: height 0.3s;
      transform: rotate(180deg);
    }

    input[type="range"],
    input[type="text"] {
      width: 90%;
      margin: 5px 0;
    }

    select {
      width: 90%;
      padding: 5px;
      margin: 5px 0;
    }

    .cellmainoption {
      padding: 10px;
      vertical-align: middle;
      border: 1px solid #ccc;
      text-align: right;
    }

    .selectmainoption {
      padding: 2px;
      margin: 2px;
      width: auto;
    }

    .cell>select {
      display: inline-block;
      margin-right: 20px;
    }

    .cell label {
      margin-right: 10px;
    }

    .cell>select:last-child {
      margin-right: 0;
    }

    .cost-breakdown {
      flex-grow: 1;
      padding-left: 10px;
      text-align: left;
      white-space: pre-wrap;
      vertical-align: top;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <table>
    <tr>
      <td colspan="3" class="cell">
        <h2>Database Cost Comparator Aurora vs CockroachDB</h2>
      </td>
    </tr>

    <tr>
      <td colspan="3" class="cellmainoption">
        <label for="region-select">Region:</label>
        <select id="region-select" class="selectmainoption">
          <option value="us-east-1">US East (N. Virginia)</option>
          <option value="us-west-1">US West (N. California)</option>
          <option value="eu-west-1">EU (Ireland)</option>
          <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
        </select>
        <label for="comparison-select">Comparison:</label>
        <select id="comparison-select" class="selectmainoption">
          <option value="automatic">Automatic</option>
          <option value="manual">Manual</option>
        </select>
      </td>
    </tr>

    <tr>
      <td class="cell">
        <h3>Aurora</h3>
        <!-- New drop-down for number of instances -->
        <label for="aurora-instance-count">Number of Instances:</label>
        <select id="aurora-instance-count">
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
        <br>
        <label for="aurora-instance-type">Instance Type:</label>
        <select id="aurora-instance-type">
          <option value="db.x2g.large" data-standard="0.377" data-optimized="0.49" ec2-selfmanagedprice="" data-memory="32" data-cpu="2">db.x2g.large</option>
          <option value="db.x2g.xlarge" data-standard="0.754" data-optimized="0.98" ec2-selfmanagedprice="" data-memory="64" data-cpu="4">db.x2g.xlarge</option>
          <option value="db.x2g.2xlarge" data-standard="1.508" data-optimized="1.96" ec2-selfmanagedprice="" data-memory="128" data-cpu="8">db.x2g.2xlarge</option>
          <option value="db.x2g.4xlarge" data-standard="3.016" data-optimized="3.921" ec2-selfmanagedprice="" data-memory="256" data-cpu="16">db.x2g.4xlarge</option>
          <option value="db.x2g.8xlarge" data-standard="6.032" data-optimized="7.842" ec2-selfmanagedprice="" data-memory="512" data-cpu="32">db.x2g.8xlarge</option>
          <option value="db.x2g.12xlarge" data-standard="9.048" data-optimized="11.762" ec2-selfmanagedprice="" data-memory="768" data-cpu="48">db.x2g.12xlarge</option>
          <option value="db.x2g.16xlarge" data-standard="12.064" data-optimized="15.683" ec2-selfmanagedprice="" data-memory="1024" data-cpu="64">db.x2g.16xlarge</option>
          <option value="db.r7g.large" data-standard="0.276" data-optimized="0.359" ec2-selfmanagedprice="" data-memory="16" data-cpu="2">db.r7g.large</option>
          <option value="db.r7g.xlarge" data-standard="0.553" data-optimized="0.719" ec2-selfmanagedprice="" data-memory="32" data-cpu="4">db.r7g.xlarge</option>
          <option value="db.r7g.2xlarge" data-standard="1.106" data-optimized="1.437" ec2-selfmanagedprice="" data-memory="64" data-cpu="8">db.r7g.2xlarge</option>
          <option value="db.r7g.4xlarge" data-standard="2.211" data-optimized="2.874" ec2-selfmanagedprice="" data-memory="128" data-cpu="16">db.r7g.4xlarge</option>
          <option value="db.r7g.8xlarge" data-standard="4.422" data-optimized="5.749" ec2-selfmanagedprice="1.7136" data-memory="256" data-cpu="32">db.r7g.8xlarge</option>
          <option value="db.r7g.12xlarge" data-standard="6.633" data-optimized="8.623" ec2-selfmanagedprice="" data-memory="384" data-cpu="48">db.r7g.12xlarge</option>
          <option value="db.r7g.16xlarge" data-standard="8.844" data-optimized="11.497" ec2-selfmanagedprice="" data-memory="512" data-cpu="64">db.r7g.16xlarge</option>
          <option value="db.r6g.large" data-standard="0.26" data-optimized="0.338" ec2-selfmanagedprice="" data-memory="16" data-cpu="2">db.r6g.large</option>
          <option value="db.r6g.xlarge" data-standard="0.519" data-optimized="0.675" ec2-selfmanagedprice="" data-memory="32" data-cpu="4">db.r6g.xlarge</option>
          <option value="db.r6g.2xlarge" data-standard="1.038" data-optimized="1.349" ec2-selfmanagedprice="" data-memory="64" data-cpu="8">db.r6g.2xlarge</option>
          <option value="db.r6g.4xlarge" data-standard="2.076" data-optimized="2.699" ec2-selfmanagedprice="" data-memory="128" data-cpu="16">db.r6g.4xlarge</option>
          <option value="db.r6g.8xlarge" data-standard="4.153" data-optimized="5.399" ec2-selfmanagedprice="1.7136" data-memory="256" data-cpu="32">db.r6g.8xlarge</option>
          <option value="db.r6g.12xlarge" data-standard="6.229" data-optimized="8.098" ec2-selfmanagedprice="" data-memory="384" data-cpu="48">db.r6g.12xlarge</option>
          <option value="db.r6g.16xlarge" data-standard="8.306" data-optimized="10.798" ec2-selfmanagedprice="" data-memory="512" data-cpu="64">db.r6g.16xlarge</option>
          <option value="db.r6i.large" data-standard="0.29" data-optimized="0.377" ec2-selfmanagedprice="" data-memory="16" data-cpu="2">db.r6i.large</option>
          <option value="db.r6i.xlarge" data-standard="0.58" data-optimized="0.754" ec2-selfmanagedprice="" data-memory="32" data-cpu="4">db.r6i.xlarge</option>
          <option value="db.r6i.2xlarge" data-standard="1.16" data-optimized="1.508" ec2-selfmanagedprice="" data-memory="64" data-cpu="8">db.r6i.2xlarge</option>
          <option value="db.r6i.4xlarge" data-standard="2.32" data-optimized="3.016" ec2-selfmanagedprice="" data-memory="128" data-cpu="16">db.r6i.4xlarge</option>
          <option value="db.r6i.8xlarge" data-standard="4.64" data-optimized="6.032" ec2-selfmanagedprice="2.016" data-memory="256" data-cpu="32">db.r6i.8xlarge</option>
          <option value="db.r6i.12xlarge" data-standard="6.96" data-optimized="9.048" ec2-selfmanagedprice="" data-memory="384" data-cpu="48">db.r6i.12xlarge</option>
          <option value="db.r6i.16xlarge" data-standard="9.28" data-optimized="12.064" ec2-selfmanagedprice="" data-memory="512" data-cpu="64">db.r6i.16xlarge</option>
          <option value="db.r6i.24xlarge" data-standard="13.92" data-optimized="18.096" ec2-selfmanagedprice="" data-memory="768" data-cpu="96">db.r6i.24xlarge</option>
          <option value="db.r6i.32xlarge" data-standard="18.56" data-optimized="24.128" ec2-selfmanagedprice="" data-memory="1024" data-cpu="128">db.r6i.32xlarge</option>
          <option value="db.r5.large" data-standard="0.29" data-optimized="0.377" ec2-selfmanagedprice="0.126" data-memory="16" data-cpu="2" selected>db.r5.large</option>
          <option value="db.r5.xlarge" data-standard="0.58" data-optimized="0.754" ec2-selfmanagedprice="0.252" data-memory="32" data-cpu="4">db.r5.xlarge</option>
          <option value="db.r5.2xlarge" data-standard="1.16" data-optimized="1.508" ec2-selfmanagedprice="0.504" data-memory="64" data-cpu="8">db.r5.2xlarge</option>
          <option value="db.r5.4xlarge" data-standard="2.32" data-optimized="3.016" ec2-selfmanagedprice="1.008" data-memory="128" data-cpu="16">db.r5.4xlarge</option>
          <option value="db.r5.8xlarge" data-standard="4.64" data-optimized="6.032" ec2-selfmanagedprice="2.016" data-memory="256" data-cpu="32">db.r5.8xlarge</option>
          <option value="db.r5.12xlarge" data-standard="6.96" data-optimized="9.048" ec2-selfmanagedprice="3.024" data-memory="384" data-cpu="48">db.r5.12xlarge</option>
          <option value="db.r5.16xlarge" data-standard="9.28" data-optimized="12.064" ec2-selfmanagedprice="4.032" data-memory="512" data-cpu="64">db.r5.16xlarge</option>
          <option value="db.r5.24xlarge" data-standard="13.92" data-optimized="18.096" ec2-selfmanagedprice="6.048" data-memory="768" data-cpu="96">db.r5.24xlarge</option>
        </select>
        <br>
        <span id="aurora-memory">Memory: 32 GiB</span> <span id="aurora-vcpu"> VCPU: 32 </span>
        <br><br>
        <label for="aurora-storage">Storage Size (GB):</label>
        <input type="text" id="aurora-storage" value="1">
        <br>
        <!-- Aurora: Average Ops and computed I/O display -->
        <label for="aurora-ops">Average Operations per Second:</label>
        <input type="text" id="aurora-ops" value="1">
        <span id="computed-io"> (Computed I/O: 0.00 million)</span>
      </td>

      <td class="cell">
        <h3>CockroachDB</h3>
        <label for="cockroachdb-nodes">Number of Nodes:</label>
        <input type="range" id="cockroachdb-nodes" min="3" max="30" step="3" value="3">
        <span id="node-count">1</span>
        <br>
        <label for="cockroachdb-instance-type">Instance Type:</label>
        <select id="cockroachdb-instance-type">
            <option value="standard-2vcpu" data-selfmanagedprice="0.096" data-price="0.455">2 vCPUs (Standard)</option>
            <option value="standard-4vcpu" data-selfmanagedprice="0.192" data-price="0.81">4 vCPUs (Standard)</option>
            <option value="standard-8vcpu" data-selfmanagedprice="0.384" data-price="1.439">8 vCPUs (Standard)</option>
            <option value="standard-16vcpu" data-selfmanagedprice=".768" data-price="2.797">16 vCPUs (Standard)</option>
            <option value="standard-32vcpu" data-selfmanagedprice="1.536" data-price="5.297">32 vCPUs (Standard)</option>
            <option value="advanced-2vcpu" data-selfmanagedprice="0.096" data-price="0.523">2 vCPUs (Advanced)</option>
            <option value="advanced-4vcpu" data-selfmanagedprice="0.193" data-price="0.931">4 vCPUs (Advanced)</option>
            <option value="advanced-8vcpu" data-selfmanagedprice="0.384" data-price="1.655">8 vCPUs (Advanced)</option>
            <option value="advanced-16vcpu" data-selfmanagedprice="0.768" data-price="3.217">16 vCPUs (Advanced)</option>
            <option value="advanced-32vcpu" data-selfmanagedprice="1.536" data-price="6.091">32 vCPUs (Advanced)</option>
        </select>
        <br>
        <label for="cockroachdb-storage">Storage Size (GB):</label>
        <input type="text" id="cockroachdb-storage" value="1">
        <br>
        <!-- CockroachDB: Average Ops and computed I/O display -->
        <label for="cockroachdb-ops">Average Operations per Second:</label>
        <input type="text" id="cockroachdb-ops" value="1">
        <span id="cockroach-computed-io"> (Computed I/O: 0.00 million)</span>
      </td>

      <td class="cell">
        <h3>Usage per Level</h3>
        <table>
          <thead>
            <tr>
              <th>Level</th>
              <th>Level Time Percentage</th>
              <th>Level Nodes</th>
            </tr>
          </thead>
           <tbody id="usage-schedule-body">
              <!-- Rows will be inserted dynamically -->
            </tbody>
        </table>
      </td>
    </tr>

    <tr>
      <td class="cell">
        <div class="bar-group">
          <div class="bar-container">
            <div class="bar">
              <div id="aurora-bar" class="filled-bar"></div>
            </div>
            <div class="cost-breakdown">
              <span id="aurora-cost" class="bar-value">$0.00</span>
              <span id="aurora-breakdown"></span>
            </div>
          </div>
          <div class="bar-container">
            <div class="bar">
              <div id="aurora-optimized-bar" class="filled-bar"></div>
            </div>
            <div class="cost-breakdown">
              <span id="aurora-optimized-cost" class="bar-value">$0.00</span>
              <span id="aurora-optimized-breakdown"></span>
            </div>
          </div>
        </div>
      </td>

      <td class="cell">
        <div class="bar-group">
          <div class="bar-container">
            <div class="bar">
              <div id="cockroachdb-bar" class="filled-bar"></div>
            </div>
            <div class="cost-breakdown">
              <span id="cockroachdb-cost" class="bar-value">$0.00</span>
              <span id="cockroachdb-breakdown"></span>
            </div>
          </div>
          <div class="bar-container">
            <div class="bar">
              <div id="self-managed-bar" class="filled-bar"></div>
            </div>
            <div class="cost-breakdown">
              <span id="self-managed-cost" class="bar-value">$0.00</span>
              <span id="self-managed-breakdown"></span>
            </div>
          </div>
        </div>
      </td>
      <td class="cell">
       <div class="bar-group">
         <div class="bar-container">
           <div class="bar"><div id="self-managed-optimized-bar" class="filled-bar"></div></div>
           <div class="cost-breakdown" style="font-size:11px;">
             <span id="self-managed-optimized-cost" class="bar-value">$0.00</span>
             <span id="self-managed-optimized-breakdown"></span>
             <h4 style="margin:5px 0 0; font-size:11px;">Instance Cost Breakdown by Level</h4>
             <table id="instance-breakdown" style="width:100%;border-collapse:collapse;font-size:10px;">
               <thead><tr style="background-color:#f8f9fa;"><th style="border:1px solid #ccc;padding:2px;">Level</th><th style="border:1px solid #ccc;padding:2px;">Up Percentage</th><th style="border:1px solid #ccc;padding:2px;">Node Count</th><th style="border:1px solid #ccc;padding:2px;">Instance Cost</th></tr></thead>
               <tbody><!-- Breakdown rows inserted dynamically --></tbody>
             </table>
           </div>
         </div>
       </div>
     </td>
    </tr>
  </table>
<script>
// Global variables.
var cockroachdbCost = 0;
var selfmanagedinstancepriceCalc = 0;
var selfmanagedinstanceprice = 200;

document.addEventListener("DOMContentLoaded", function() {
  // Helper: Safely get a usage percentage from an element.
  function getUsagePct(id, defaultValue = 0) {
    const el = document.getElementById(id);
    return el ? parseFloat(el.value) / 100 : defaultValue;
  }

  // Always regenerate the usage schedule rows based solely on the number of CockroachDB nodes.
function updateUsageSchedule() {
  const nodes = parseInt(document.getElementById("cockroachdb-nodes").value);
  let html = "";
  if (nodes === 3) {
    // All nodes are minimal.
    html = `
      <tr>
        <td>Minimal</td>
        <td>
          <input id="usage-minimal" type="number" value="100" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-minimal" type="hidden" value="3">3
        </td>
      </tr>
      <tr>
        <td>Unused</td>
        <td><input id="usage-low" type="number" value="0" style="width:4em;" oninput="updateCost()"></td>
        <td>
          <input id="nodes-low" type="hidden" value="0">0
        </td>
      </tr>
      <tr>
        <td>Unused</td>
        <td><input id="usage-medium" type="number" value="0" style="width:4em;" oninput="updateCost()"></td>
        <td>
          <input id="nodes-medium" type="hidden" value="0">0
        </td>
      </tr>
      <tr>
        <td>Unused</td>
        <td><input id="usage-peak" type="number" value="0" style="width:4em;" oninput="updateCost()"></td>
        <td>
          <input id="nodes-peak" type="hidden" value="0">0
        </td>
      </tr>
    `;
  } else if (nodes > 3 && nodes <= 9) {
    // Minimal always 3; Low gets the remainder.
    const lowNodes = nodes - 3;
    html = `
      <tr>
        <td>Minimal</td>
        <td>
          <input id="usage-minimal" type="number" value="100" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-minimal" type="hidden" value="3">3
        </td>
      </tr>
      <tr>
        <td>Normal</td>
        <td>
          <input id="usage-low" type="number" value="75" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-low" type="hidden" value="${lowNodes}">${lowNodes}
        </td>
      </tr>
      <tr>
        <td>Unused</td>
        <td>
          <input id="usage-medium" type="number" value="0" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-medium" type="hidden" value="0">0
        </td>
      </tr>
      <tr>
        <td>Unused</td>
        <td>
          <input id="usage-peak" type="number" value="0" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-peak" type="hidden" value="0">0
        </td>
      </tr>
    `;
  } else if (nodes > 9 && nodes <= 18) {
    // Minimal = 3, Low = 6, Medium = nodes - 9.
    const mediumNodes = nodes - 9;
    html = `
      <tr>
        <td>Minimal</td>
        <td>
          <input id="usage-minimal" type="number" value="100" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-minimal" type="hidden" value="3">3
        </td>
      </tr>
      <tr>
        <td>Normal</td>
        <td>
          <input id="usage-low" type="number" value="50" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-low" type="hidden" value="6">6
        </td>
      </tr>
      <tr>
        <td>Peak</td>
        <td>
          <input id="usage-medium" type="number" value="25" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-medium" type="hidden" value="${mediumNodes}">${mediumNodes}
        </td>
      </tr>
      <tr>
        <td>Unused</td>
        <td>
          <input id="usage-peak" type="number" value="0" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-peak" type="hidden" value="0">0
        </td>
      </tr>
    `;
  } else if (nodes > 18) {
    // Minimal = 3, Low = 6, Medium = 9, Peak = nodes - 18.
    const peakNodes = nodes - 18;
    html = `
      <tr>
        <td>Minimal</td>
        <td>
          <input id="usage-minimal" type="number" value="100" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-minimal" type="hidden" value="3">3
        </td>
      </tr>
      <tr>
        <td>Low</td>
        <td>
          <input id="usage-low" type="number" value="50" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-low" type="hidden" value="6">6
        </td>
      </tr>
      <tr>
        <td>Normal</td>
        <td>
          <input id="usage-medium" type="number" value="30" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-medium" type="hidden" value="9">9
        </td>
      </tr>
      <tr>
        <td>Peak</td>
        <td>
          <input id="usage-peak" type="number" value="25" style="width:4em;" oninput="updateCost()">
        </td>
        <td>
          <input id="nodes-peak" type="hidden" value="${peakNodes}">${peakNodes}
        </td>
      </tr>
    `;
  }
  document.getElementById("usage-schedule-body").innerHTML = html;
  updateCost();
}


  // Main cost update function.
  function updateCost() {


    // --- Aurora Calculations (Working version) ---
    const auroraInstanceType = document.getElementById("aurora-instance-type");
    const auroraStorage = parseFloat(document.getElementById("aurora-storage").value);
    // Use the value from "aurora-ops" (ensure your HTML input has id="aurora-ops")
    let auroraOps = parseFloat(document.getElementById("aurora-ops").value);
    if(isNaN(auroraOps)) {
      auroraOps = 1; // fallback value
    }
    // Compute monthly I/O requests in millions for Aurora (730 hours * 3600 sec/hr)
    const computedIO = (auroraOps * 730 * 3600) / 1000000;
    document.getElementById("computed-io").textContent = ` (Computed I/O: ${computedIO.toFixed(2)} million)`;
    const auroraStandardPrice = parseFloat(
      auroraInstanceType.options[auroraInstanceType.selectedIndex].getAttribute("data-standard")
    );
    const auroraOptimizedPrice = parseFloat(
      auroraInstanceType.options[auroraInstanceType.selectedIndex].getAttribute("data-optimized")
    );
    
    const auroraMemory = auroraInstanceType.options[auroraInstanceType.selectedIndex].getAttribute("data-memory");
    document.getElementById("aurora-memory").textContent = `Memory: ${auroraMemory} GiB`;
    const auroraVcpu = auroraInstanceType.options[auroraInstanceType.selectedIndex].getAttribute("data-cpu");
    document.getElementById("aurora-vcpu").textContent = `VCPU: ${auroraVcpu}`;
    
    const auroraStorageCost = auroraStorage * 0.10;
    const auroraIOCost = computedIO * 0.20;
    const aurorastoragecostioo = auroraStorage * 0.225;
    // Get instance count multiplier
    const instanceCount = parseInt(document.getElementById("aurora-instance-count").value);
    
    // Working Aurora cost calculations for a single instance.
    const auroraCostStandard = (auroraStandardPrice * 730 * instanceCount) + auroraStorageCost + auroraIOCost;
    const auroraCostOptimized = ((auroraStandardPrice * 1.3) * 730 * instanceCount) + aurorastoragecostioo;
    
    // Render Aurora breakdown displays.
    document.getElementById("aurora-breakdown").innerHTML = `
      <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif;">
        <tr style="background-color: #f8f9fa;">
          <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">Compute</td>
          <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${(auroraStandardPrice * 730 * instanceCount).toFixed(2)}</td>
        </tr>
        <tr>
          <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">Storage</td>
          <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${auroraStorageCost.toFixed(2)}</td>
        </tr>
        <tr style="background-color: #f8f9fa;">
          <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">I/O</td>
          <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${auroraIOCost.toFixed(2)}</td>
        </tr>
      </table>
    `;
    document.getElementById("aurora-optimized-breakdown").innerHTML = `
      <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif;">
        <tr style="background-color: #f8f9fa;">
          <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">Compute</td>
          <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${((auroraStandardPrice * 1.3) * 730 * instanceCount).toFixed(2)}</td>
        </tr>
        <tr>
          <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">Storage</td>
          <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${aurorastoragecostioo.toFixed(2)}</td>
        </tr>
        <tr style="background-color: #f8f9fa;">
          <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">I/O</td>
          <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$0</td>
        </tr>
      </table>
    `;
    document.getElementById("aurora-optimized-cost").innerHTML = `
      <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
        <tr style="background-color: #f8f9fa;">
          <td style="border: 1px solid #dee2e6; padding: 15px; font-weight: bold; color: #495057;">IO Optimized</td>
        </tr>
        <tr>
          <td style="border: 1px solid #dee2e6; padding: 20px; font-size: 24px; color: #ffffff; background-color: #b3c6c1;">
            $${auroraCostOptimized.toFixed(2)}
          </td>
        </tr>
      </table>
    `;
    
    // --- CockroachDB & Self-Managed Calculations ---
    const cockroachdbNodes = parseInt(document.getElementById("cockroachdb-nodes").value);
    document.getElementById("node-count").textContent = cockroachdbNodes;
    
    // Get usage schedule percentages.
    const minimalPct = getUsagePct("usage-minimal");
    const lowPct = getUsagePct("usage-low");
    const mediumPct = getUsagePct("usage-medium");
    const peakPct = getUsagePct("usage-peak");
    
    // Fixed node counts per level.
//    const minimalNodes = 3, lowNodes = 6, mediumNodes = 9;
//     let peakNodes = cockroachdbNodes - 9;
//     if (peakNodes < 0) peakNodes = 0;
    const minimalNodes = parseInt(document.getElementById("nodes-minimal").value) || 0;
    const lowNodes = parseInt(document.getElementById("nodes-low").value) || 0;
    const mediumNodes = parseInt(document.getElementById("nodes-medium").value) || 0;
    const peakNodes = parseInt(document.getElementById("nodes-peak").value) || 0;

    
    const cockroachdbInstanceType = document.getElementById("cockroachdb-instance-type");
    const cockroachdbStorage = parseFloat(document.getElementById("cockroachdb-storage").value);
    let cockroachOps = parseFloat(document.getElementById("cockroachdb-ops").value);
    let computedCockroachIO = (cockroachOps * 730 * 3600) / 1000000;
    
    const cockroachdbPrice = parseFloat(
      cockroachdbInstanceType.options[cockroachdbInstanceType.selectedIndex].getAttribute("data-price")
    );
    const cockroachdbStorageCost = cockroachdbStorage * 0.00045792 * 730;
    const cockroachdbIOCost = computedCockroachIO * 0.00001956947162 * 730;
    // Debugging: Print all variables
    console.log("CockroachDB Instance Type:", cockroachdbInstanceType);
    console.log("CockroachDB Storage:", cockroachdbStorage);
    console.log("CockroachDB IO:", computedCockroachIO);
    console.log("CockroachDB Price:", cockroachdbPrice);
    console.log("CockroachDB Storage Cost:", cockroachdbStorageCost);
    console.log("CockroachDB IO Cost:", cockroachdbIOCost);
    
    const cockroachOption = cockroachdbInstanceType.options[cockroachdbInstanceType.selectedIndex];
    // Try to get a dedicated self-managed price attribute; if not present, fall back to data-price.
    const selfmanagedPrice = parseFloat(cockroachOption.getAttribute("data-selfmanagedprice")) ||
    				parseFloat(cockroachOption.getAttribute("data-price"));

    console.log("self managed price 3:", selfmanagedPrice);
    const mode = document.getElementById("comparison-select").value;
    if (mode !== "manual") {
      // In automatic mode, mirror Aurora's ops to CockroachDB.
      cockroachOps = auroraOps;
      document.getElementById("cockroachdb-ops").value = auroraOps;
      computedCockroachIO = (cockroachOps * 730 * 3600) / 1000000;
      document.getElementById("cockroach-computed-io").textContent = ` (Computed I/O: ${computedCockroachIO.toFixed(2)} million)`;
    } else {
      document.getElementById("cockroach-computed-io").textContent = ` (Computed I/O: ${computedCockroachIO.toFixed(2)} million)`;
    }
    
    if (mode === "manual") {
      document.getElementById("cockroachdb-storage").disabled = false;
      document.getElementById("cockroachdb-ops").disabled = false;
      document.getElementById("cockroachdb-nodes").disabled = false;
      document.getElementById("cockroachdb-instance-type").disabled = false;
      
      cockroachdbCost = (cockroachdbPrice * 730 * cockroachdbNodes) + cockroachdbStorageCost + cockroachdbIOCost;
      selfmanagedinstancepriceCalc = (selfmanagedPrice * 730 * cockroachdbNodes) + auroraStorageCost;
    } else {
      document.getElementById("cockroachdb-ops").disabled = true;
      document.getElementById("cockroachdb-storage").disabled = true;
      document.getElementById("cockroachdb-nodes").disabled = true;
      document.getElementById("cockroachdb-instance-type").disabled = true;
      
      let selectedCockroachdbOption;
      const cockroachdbOptions = cockroachdbInstanceType.options;
      for (let i = 0; i < cockroachdbOptions.length; i++) {
        const cockroachdbVcpu = parseInt(cockroachdbOptions[i].text.match(/(\d+)\s*vCPUs/)[1]);
        if (parseInt(cockroachdbVcpu) === parseInt(auroraVcpu)) {
          selectedCockroachdbOption = cockroachdbOptions[i];
          break;
        }
      }
      if (!selectedCockroachdbOption) {
        for (let i = 0; i < cockroachdbOptions.length; i++) {
          const cockroachdbVcpuMatch = cockroachdbOptions[i].text.match(/(\d+)\s*vCPUs/);
          if (parseInt(cockroachdbVcpuMatch[1]) === 8) {
            selectedCockroachdbOption = cockroachdbOptions[i];
            break;
          }
        }
      }
      if (selectedCockroachdbOption) {
        document.getElementById("cockroachdb-instance-type").value = selectedCockroachdbOption.value;
      }
      document.getElementById("cockroachdb-storage").value = auroraStorage * 3;
      const nodesVal = parseInt(document.getElementById("cockroachdb-nodes").value);
      cockroachdbCost = (cockroachdbPrice * 730 * nodesVal) + cockroachdbStorageCost + cockroachdbIOCost;
      selfmanagedinstancepriceCalc = (selfmanagedPrice * 730 * nodesVal) + auroraStorageCost;  // EBS is the same cost as EBS ;
    }
    
    const selfManagedCostMinimal = (selfmanagedPrice * minimalNodes * 730) * minimalPct;
    const selfManagedCostLow = (selfmanagedPrice * lowNodes * 730) * lowPct;
    const selfManagedCostMedium = (selfmanagedPrice * mediumNodes * 730) * mediumPct;
    const selfManagedCostPeak = (selfmanagedPrice * peakNodes * 730) * peakPct;
    const selfManagedOptimizedInstanceCost = selfManagedCostMinimal + selfManagedCostLow + selfManagedCostMedium + selfManagedCostPeak;
    const selfManagedOptimizedCost = selfManagedOptimizedInstanceCost + auroraStorageCost;
   //  Cockroach costs
        document.getElementById("cockroachdb-cost").innerHTML = `
    <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
      <tr style="background-color: #f8f9fa;">
        <td style="border: 1px solid #dee2e6; padding: 15px; font-weight: bold; color: #495057;">Cockroach DB</td>
      </tr>
      <tr>
        <td style="border: 1px solid #dee2e6; padding: 20px; font-size: 24px; color: #ffffff; background-color: #b3c6c1;">
          $${cockroachdbCost.toFixed(2)}
        </td>
      </tr>
    </table>
  `;

      document.getElementById("self-managed-cost").innerHTML = `
    <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
      <tr style="background-color: #f8f9fa;">
        <td style="border: 1px solid #dee2e6; padding: 15px; font-weight: bold; color: #495057;">Self Managed</td>
      </tr>
      <tr>
        <td style="border: 1px solid #dee2e6; padding: 20px; font-size: 24px; color: #ffffff; background-color: #b3c6c1;">
          $${selfmanagedinstancepriceCalc.toFixed(2)}
        </td>
      </tr>
    </table>
  `;
      document.getElementById("self-managed-optimized-cost").innerHTML = `
    <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
      <tr style="background-color: #f8f9fa;">
        <td style="border: 1px solid #dee2e6; padding: 15px; font-weight: bold; color: #495057;">Self Managed Optimized</td>
      </tr>
      <tr>
        <td style="border: 1px solid #dee2e6; padding: 20px; font-size: 24px; color: #ffffff; background-color: #b3c6c1;">
          $${selfManagedOptimizedCost.toFixed(2)}
        </td>
      </tr>
    </table>
  `;

   // Cockroach DB Detailed Breakdown (using total nodes from slider):
document.getElementById("cockroachdb-breakdown").innerHTML = `
  <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
    <tr style="background-color: #f8f9fa;">
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">Node Cost</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${(cockroachdbPrice * 730 * cockroachdbNodes).toFixed(2)}</td>
    </tr>
    <tr>
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">Storage</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${cockroachdbStorageCost.toFixed(2)}</td>
    </tr>
    <tr style="background-color: #f8f9fa;">
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold; color: #495057;">I/O</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${cockroachdbIOCost.toFixed(2)}</td>
    </tr>
  </table>
`;

// Self Managed Detailed Breakdown (using total nodes from slider):
document.getElementById("self-managed-breakdown").innerHTML = `
  <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
    <tr style="background-color: #f8f9fa;">
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold;">Instance</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${(selfmanagedPrice * 730 * cockroachdbNodes).toFixed(2)}</td>
    </tr>
    <tr>
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold;">Storage</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${auroraStorageCost.toFixed(2)}</td>
    </tr>
    <tr style="background-color: #f8f9fa;">
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold;">I/O</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$0</td>
    </tr>
  </table>
`;

// Self Managed Optimized Detailed Breakdown (using dynamic level counts and usage percentages):
document.getElementById("self-managed-optimized-breakdown").innerHTML = `
  <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
    <tr style="background-color: #f8f9fa;">
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold;">Instance</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${selfManagedOptimizedInstanceCost.toFixed(2)}</td>
    </tr>
    <tr>
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold;">Storage</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$${auroraStorageCost.toFixed(2)}</td>
    </tr>
    <tr style="background-color: #f8f9fa;">
      <td style="border: 1px solid #dee2e6; padding: 10px; font-weight: bold;">I/O</td>
      <td style="border: 1px solid #dee2e6; padding: 10px; color: #343a40;">$0</td>
    </tr>
  </table>
`; 
    
    // Render Aurora cost displays.
    document.getElementById("aurora-cost").innerHTML = `
      <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
        <tr style="background-color: #f8f9fa;">
          <td style="border: 1px solid #dee2e6; padding: 15px; font-weight: bold;">Aurora Provisioned</td>
        </tr>
        <tr>
          <td style="border: 1px solid #dee2e6; padding: 20px; font-size: 24px; color: #ffffff; background-color: #b3c6c1;">
            $${auroraCostStandard.toFixed(2)}
          </td>
        </tr>
      </table>
    `;
    
    document.getElementById("aurora-optimized-cost").innerHTML = `
      <table style="border-collapse: collapse; width: 100%; font-family: 'Poppins', sans-serif; text-align: center;">
        <tr style="background-color: #f8f9fa;">
          <td style="border: 1px solid #dee2e6; padding: 15px; font-weight: bold;">IO Optimized</td>
        </tr>
        <tr>
          <td style="border: 1px solid #dee2e6; padding: 20px; font-size: 24px; color: #ffffff; background-color: #b3c6c1;">
            $${auroraCostOptimized.toFixed(2)}
          </td>
        </tr>
      </table>
    `;
  // Build Instance Cost Breakdown by Level inside Self Managed Optimized cell
  let breakdownRows = "";
  // totalNodes was defined earlier as cockroachdbNodes
  const totalNodes = cockroachdbNodes; 
  if(totalNodes === 3) {
    breakdownRows += `
      <tr>
        <td>Minimal</td>
        <td>${document.getElementById("usage-minimal").value}%</td>
        <td>${document.getElementById("nodes-minimal").value}</td>
        <td>$${selfManagedCostMinimal.toFixed(2)}</td>
      </tr>
    `;
  } else if(totalNodes > 3 && totalNodes <= 9) {
    breakdownRows += `
      <tr>
        <td>Minimal</td>
        <td>${document.getElementById("usage-minimal").value}%</td>
        <td>${document.getElementById("nodes-minimal").value}</td>
        <td>$${selfManagedCostMinimal.toFixed(2)}</td>
      </tr>
      <tr>
        <td>Normal</td>
        <td>${document.getElementById("usage-low").value}%</td>
        <td>${document.getElementById("nodes-low").value}</td>
        <td>$${selfManagedCostLow.toFixed(2)}</td>
      </tr>
    `;
  } else if(totalNodes > 9 && totalNodes <= 18) {
    breakdownRows += `
      <tr>
        <td>Minimal</td>
        <td>${document.getElementById("usage-minimal").value}%</td>
        <td>${document.getElementById("nodes-minimal").value}</td>
        <td>$${selfManagedCostMinimal.toFixed(2)}</td>
      </tr>
      <tr>
        <td>Normal</td>
        <td>${document.getElementById("usage-low").value}%</td>
        <td>${document.getElementById("nodes-low").value}</td>
        <td>$${selfManagedCostLow.toFixed(2)}</td>
      </tr>
      <tr>
        <td>Peak</td>
        <td>${document.getElementById("usage-medium").value}%</td>
        <td>${document.getElementById("nodes-medium").value}</td>
        <td>$${selfManagedCostMedium.toFixed(2)}</td>
      </tr>
    `;
  } else if(totalNodes > 18) {
    breakdownRows += `
      <tr>
        <td>Minimal</td>
        <td>${document.getElementById("usage-minimal").value}%</td>
        <td>${document.getElementById("nodes-minimal").value}</td>
        <td>$${selfManagedCostMinimal.toFixed(2)}</td>
      </tr>
      <tr>
        <td>Low</td>
        <td>${document.getElementById("usage-low").value}%</td>
        <td>${document.getElementById("nodes-low").value}</td>
        <td>$${selfManagedCostLow.toFixed(2)}</td>
      </tr>
      <tr>
        <td>Normal</td>
        <td>${document.getElementById("usage-medium").value}%</td>
        <td>${document.getElementById("nodes-medium").value}</td>
        <td>$${selfManagedCostMedium.toFixed(2)}</td>
      </tr>
      <tr>
        <td>Peak</td>
        <td>${document.getElementById("usage-peak").value}%</td>
        <td>${document.getElementById("nodes-peak").value}</td>
        <td>$${selfManagedCostPeak.toFixed(2)}</td>
      </tr>
    `;
  }
  document.querySelector("#instance-breakdown tbody").innerHTML = breakdownRows;

    
    // Update bar chart heights/colors.
    const bars = [
      { id: "aurora-bar", cost: auroraCostStandard },
      { id: "cockroachdb-bar", cost: cockroachdbCost },
      { id: "aurora-optimized-bar", cost: auroraCostOptimized },
      { id: "self-managed-optimized-bar", cost: selfManagedOptimizedCost || 0 },
      { id: "self-managed-bar", cost: selfmanagedinstancepriceCalc || 0 }
    ];
    const maxBarCost = Math.max(...bars.map(item => item.cost));
    const minBarCost = Math.min(...bars.map(item => item.cost));
    
    function applyGradient(el, color) {
      el.style.background = `linear-gradient(to top, ${color} 0%, ${color}80 100%)`;
    }
    
    bars.forEach(item => {
      const el = document.getElementById(item.id);
      el.style.height = `${(item.cost / maxBarCost) * 100}%`;
      if (item.cost === maxBarCost) {
        applyGradient(el, "#e74c3c");
      } else if (item.cost === minBarCost) {
        applyGradient(el, "#27ae60");
      } else {
        applyGradient(el, "#3498db");
      }
    });
  }
  window.updateCost = updateCost;
  
  // Attach event listeners.
  document.getElementById("cockroachdb-nodes").addEventListener("input", updateUsageSchedule);
  document.getElementById("comparison-select").addEventListener("change", updateUsageSchedule);
  document.getElementById("aurora-instance-type").addEventListener("change", updateCost);
  document.getElementById("aurora-storage").addEventListener("input", updateCost);
  document.getElementById("aurora-ops").addEventListener("input", updateCost);
  document.getElementById("aurora-instance-count").addEventListener("change", updateCost);
  document.getElementById("cockroachdb-instance-type").addEventListener("change", updateCost);
  document.getElementById("cockroachdb-storage").addEventListener("input", updateCost);
  document.getElementById("cockroachdb-ops").addEventListener("input", updateCost);
  document.getElementById("comparison-select").addEventListener("change", updateCost);
  
  // Initial call.
  updateUsageSchedule();
});
</script>

</body>
</html>


